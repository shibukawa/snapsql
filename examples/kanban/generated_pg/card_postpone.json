{"cel_environments":[{"index":0,"additional_variables":[{"name":"src_board_id","type":"int","value":1},{"name":"dst_board_id","type":"int","value":1}],"container":"root"}],"cel_expressions":[{"id":"expr_001","expression":"src_board_id","environment_index":0,"position":{"line":54,"column":30},"type_descriptor":"int","result_type":1},{"id":"expr_002","expression":"dst_board_id","environment_index":0,"position":{"line":40,"column":26},"type_descriptor":"int","result_type":1}],"description":"Moves all unfinished cards from a source board to the corresponding lists of a destination board created from templates. The destination list is chosen by matching stage_order; lists in the terminal stage (the maximum stage_order on the source board) retain their cards.","format_version":"1","function_name":"card_postpone","instructions":[{"op":"EMIT_STATIC","pos":"18:1","value":"WITH done_stage AS ( SELECT stage_order AS stage_limit FROM lists WHERE board_id = "},{"op":"EMIT_EVAL","pos":"26:26","expr_index":0},{"op":"EMIT_STATIC","pos":"27:0","value":" ORDER BY stage_order DESC, id DESC LIMIT 1 ), new_list AS ( SELECT id AS new_list_id FROM lists WHERE board_id = "},{"op":"EMIT_EVAL","pos":"40:26","expr_index":1},{"op":"EMIT_STATIC","pos":"41:0","value":" ORDER BY stage_order ASC, id ASC LIMIT 1 ), undone_lists AS ( SELECT old.id AS old_list_id FROM lists AS old WHERE old.board_id = "},{"op":"EMIT_EVAL","pos":"54:30","expr_index":0},{"op":"EMIT_STATIC","pos":"55:0","value":" AND old.stage_order \u003c ( SELECT stage_limit FROM done_stage ) )UPDATE cards SET list_id = (SELECT new_list_id FROM new_list), updated_at = NOW() , created_at = "},{"op":"EMIT_SYSTEM_VALUE","default_value":"\u003cnil\u003e","system_field":"created_at"},{"op":"EMIT_STATIC","value":", created_by = "},{"op":"EMIT_SYSTEM_VALUE","default_value":"\u003cnil\u003e","system_field":"created_by"},{"op":"EMIT_STATIC","value":", updated_by = "},{"op":"EMIT_SYSTEM_VALUE","default_value":"\u003cnil\u003e","system_field":"updated_by"},{"op":"EMIT_STATIC","pos":"72:1","value":"WHERE list_id IN ( SELECT old_list_id FROM undone_lists )"}],"parameters":[{"name":"src_board_id","type":"int"},{"name":"dst_board_id","type":"int"}],"response_affinity":"none","responses":[{"name":"affected_rows","type":"int","hierarchy_key_level":1}],"statement_type":"update","table_references":[{"name":"lists","table_name":"lists","query_name":"done_stage","context":"cte"},{"name":"cards","table_name":"cards","context":"main"},{"name":"lists","table_name":"lists","query_name":"new_list","context":"cte"},{"name":"lists","table_name":"lists","alias":"old","query_name":"undone_lists","context":"cte"}]}